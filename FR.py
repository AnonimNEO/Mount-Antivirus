#–î–∞–Ω–Ω–æ–µ –°–≤–æ–±–æ–¥–Ω–æ–µ –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ GPL-3.0-only –∏–ª–∏ GPL-3.0-or-later
#–í—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å, –≤–∑–∏–º–∞—Ç—å –ø–ª–∞—Ç—É –∑–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∞–∫—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–ø–∏–∏, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—É—é –∑–∞—â–∏—Ç—É –≤ –æ–±–º–µ–Ω –Ω–∞ –ø–ª–∞—Ç—É
#–î–õ–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –î–ê–ù–ù–û–ì–û –°–í–û–ë–û–î–ù–û–ì–û –ü–†–û–ì–†–ê–ú–ú–ù–û–ì–û –û–ë–ï–°–ü–ï–ß–ï–ù–ò–Ø, –í–ê–ú –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–ò–ù–Ø–¢–ò–ï –õ–ò–¶–ï–ù–ó–ò–ò Gnu GPL v3.0 –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
#–í –°–õ–£–ß–ê–ï –†–ê–°–ü–†–û–°–¢–†–ê–ù–ï–ù–ò–Ø –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ô –ü–†–û–ì–†–ê–ú–ú–´ –ò/–ò–õ–ò –ú–û–î–ï–†–ù–ò–ó–ò–†–û–í–ê–ù–ù–û–ô –í–ï–†–°–ò–ò –ò/–ò–õ–ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ò–°–•–û–î–ù–ò–ö–û–í –í –°–í–û–ï–ô –ü–†–û–ì–†–ê–ú–ú–ï, –í–´ –û–ë–Ø–ó–ê–ù–´ –ó–ê–î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨ –í–°–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï –ò –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú –í–û–ó–ú–û–ñ–ù–û–°–¢–¨ –ü–û–õ–£–ß–ò–¢–¨ –ò–°–•–û–î–ù–ò–ö–ò –í–ê–®–ï–ô –ö–û–ü–ò–ò –ü–†–û–ì–†–ê–ú–ú–´, –ê –¢–ê–ö–ñ–ï –£–ö–ê–ó–ê–¢–¨ –ê–í–¢–û–†–°–¢–í–û –î–ê–ù–ù–û–ì–û –ü–†–û–ì–†–ê–ú–ú–ù–û–ì–û –û–ë–ï–°–ü–ï–ß–ï–ù–ò–Ø
#–ü–†–ò –†–ê–°–ü–†–û–°–¢–†–ê–ù–ï–ù–ò–ò –ü–†–û–ì–†–ê–ú–ú–´ –í–´ –û–ë–Ø–ó–ê–ù–´ –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –í–°–ï –¢–ï–ñ–ï –ü–†–ê–í–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ –ß–¢–û –ò –ú–´ –í–ê–ú, –ê –¢–ê–ö–ñ–ï –õ–ò–¶–ï–ù–ó–ò–Ø GPL v3
#–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –ª–∏—Ü–µ–Ω–∑–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –§–æ–Ω–¥–∞ –°–≤–æ–±–æ–¥–Ω–æ–≥–æ –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –û–±–µ—Å–ø–µ—á–µ–Ω–∏—è - https://www.gnu.org/licenses/gpl-3.0.html
#–ò–ª–∏ –≤ —Ñ–∞–π–ª–µ COPYING.txt –≤ –∞—Ä—Ö–∏–≤–µ —Å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–æ–º
#Copyleft üÑØ NEO Organization, Departament K 2024 - 2025
#Coded by @AnonimNEO (Telegram)

import os
import shutil
import tkinter as tk
from tkinter import filedialog, messagebox, ttk
from loguru import logger

from RS import random_string

file_replacer = "0.2.2 Beta"

def FR():
    def browse_source(source_var):
        path = filedialog.askopenfilename(title=random_string())
        if path:
            source_var.set(path)

    def browse_target(target_var):
        path = filedialog.askopenfilename(title=random_string())
        if path:
            target_var.set(path)

    def on_preset_select(event, combo, target_var, presets_dict):
        selected = combo.get()
        path = presets_dict.get(selected, "")
        if path:
            target_var.set(path)

    def replace_file(source_var, target_var):
        final_src = source_var.get()
        final_tgt = target_var.get()

        if not final_src or not os.path.exists(final_src):
            messagebox.showerror(random_string(), "–§–∞–π–ª-–∏—Å—Ç–æ—á–Ω–∏–∫ –Ω–µ –≤—ã–±—Ä–∞–Ω –∏–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω!")
            return
        if not final_tgt:
            messagebox.showerror(random_string(), "–ü—É—Ç—å –∫ —Ü–µ–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω!")
            return

        backup_path = final_tgt + ".bak"

        try:
            #–°–æ–∑–¥–∞–µ–º –±—ç–∫–∞–ø
            if os.path.exists(final_tgt):
                shutil.copy2(final_tgt, backup_path)
                logger.info(f"FR - –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø: {backup_path}")

            #–ö–æ–ø–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ñ–∞–π–ª –Ω–∞ –º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ
            shutil.copy2(final_src, final_tgt)
            logger.success(f"–ó–∞–º–µ–Ω–µ–Ω–æ: {final_tgt}")
            messagebox.showinfo(random_string(), f"–§–∞–π–ª –∑–∞–º–µ–Ω–µ–Ω.\n–ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω –≤ —Ç–æ–º –∂–µ –∫–∞—Ç–∞–ª–æ–≥–µ")
        except PermissionError:
            messagebox.showerror(random_string(), "–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É –æ—Ç –∏–º–µ–Ω–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.")
        except Exception as e:
            logger.error(f"FR - –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–º–µ–Ω–µ —Ñ–∞–π–ª–∞:\n{e}")
            messagebox.showerror(random_string(), e)

    def restore_file(target_var):
        final_tgt = target_var.get()
        if not final_tgt:
            messagebox.showwarning(random_string(), "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É!")
            return
        
        backup_path = final_tgt + ".bak"
        if not os.path.exists(backup_path):
            messagebox.showwarning(random_string(), f"–ë—ç–∫–∞–ø –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏:\n{backup_path}")
            return

        if messagebox.askyesno(random_string(), f"–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å {os.path.basename(final_tgt)} –∏–∑ –±—ç–∫–∞–ø–∞?"):
            try:
                #–í–æ–∑–≤—Ä–∞—â–∞–µ–º –±—ç–∫–∞–ø –Ω–∞ –º–µ—Å—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
                shutil.move(backup_path, final_tgt)
                logger.success(f"FR - –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏–∑ –±—ç–∫–∞–ø–∞: {final_tgt}")
                messagebox.showinfo(random_string(), "–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.")
            except Exception as e:
                logger.error(f"FR - –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞:\n{e}")
                messagebox.showerror(random_string(), str(e))

    FR = tk.Tk()
    FR.title(random_string())
    FR.geometry("400x250")

    source_path = tk.StringVar()
    target_path = tk.StringVar()

    presets = {
        "–°–≤–æ–π –ø—É—Ç—å": "",
        "Sethc (–ó–∞–ª–∏–ø–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à)": "C:\\Windows\\System32\\sethc.exe",
        "Utilman (–°–ø–µ—Ü. –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)": "C:\\Windows\\System32\\utilman.exe",
        "Taskmgr (–î–∏—Å–ø–µ—Ç—á–µ—Ä –∑–∞–¥–∞—á)": "C:\\Windows\\System32\\taskmgr.exe",
        "Explorer (–ü—Ä–æ–≤–æ–¥–Ω–∏–∫)": "C:\\Windows\\explorer.exe"
    }

    #GUI —ç–ª–µ–º–µ–Ω—Ç—ã
    tk.Label(FR, text="1)–ù–∞, —á—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å:", font=('Segoe UI', 9, 'bold')).pack(anchor="w", padx=10, pady=(10, 0))
    src_frame = tk.Frame(FR)
    src_frame.pack(fill="x", padx=10)
    tk.Entry(src_frame, textvariable=source_path).pack(side="left", expand=True, fill="x")
    tk.Button(src_frame, text="–û–±–∑–æ—Ä", command=lambda: browse_source(source_path)).pack(side="right", padx=5)

    tk.Label(FR, text="2)–ß—Ç–æ –∑–∞–º–µ–Ω—è–µ–º:").pack(anchor="w", padx=10, pady=(10, 0))
    combo_presets = ttk.Combobox(FR, values=list(presets.keys()), state="readonly")
    combo_presets.pack(fill="x", padx=10)
    combo_presets.set("–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ—Å–µ—Ç...")
    combo_presets.bind("<<ComboboxSelected>>", lambda e: on_preset_select(e, combo_presets, target_path, presets))

    tgt_frame = tk.Frame(FR)
    tgt_frame.pack(fill="x", padx=10, pady=5)
    tk.Entry(tgt_frame, textvariable=target_path).pack(side="left", expand=True, fill="x")
    tk.Button(tgt_frame, text="–û–±–∑–æ—Ä", command=lambda: browse_target(target_path)).pack(side="right", padx=5)

    #–ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
    btn_frame = tk.Frame(FR)
    btn_frame.pack(pady=15)

    tk.Button(btn_frame, text="–ó–∞–º–µ–Ω–∏—Ç—å",
              command=lambda: replace_file(source_path, target_path), 
              bg="#ffcccc", width=15, font=('Segoe UI', 9, 'bold')).pack(side="left", padx=10)

    tk.Button(btn_frame, text="–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å",
              command=lambda: restore_file(target_path), 
              bg="#ccffcc", width=15).pack(side="left", padx=10)

    FR.mainloop()
