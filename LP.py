#–î–∞–Ω–Ω–æ–µ –°–≤–æ–±–æ–¥–Ω–æ–µ –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ GPL-3.0-only –∏–ª–∏ GPL-3.0-or-later
#–í—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å, –≤–∑–∏–º–∞—Ç—å –ø–ª–∞—Ç—É –∑–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∞–∫—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–ø–∏–∏, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—É—é –∑–∞—â–∏—Ç—É –≤ –æ–±–º–µ–Ω –Ω–∞ –ø–ª–∞—Ç—É
#–î–õ–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –î–ê–ù–ù–û–ì–û –°–í–û–ë–û–î–ù–û–ì–û –ü–†–û–ì–†–ê–ú–ú–ù–û–ì–û –û–ë–ï–°–ü–ï–ß–ï–ù–ò–Ø, –í–ê–ú –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–ò–ù–Ø–¢–ò–ï –õ–ò–¶–ï–ù–ó–ò–ò Gnu GPL v3.0 –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
#–í –°–õ–£–ß–ê–ï –†–ê–°–ü–†–û–°–¢–†–ê–ù–ï–ù–ò–Ø –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ô –ü–†–û–ì–†–ê–ú–ú–´ –ò/–ò–õ–ò –ú–û–î–ï–†–ù–ò–ó–ò–†–û–í–ê–ù–ù–û–ô –í–ï–†–°–ò–ò –ò/–ò–õ–ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ò–°–•–û–î–ù–ò–ö–û–í –í –°–í–û–ï–ô –ü–†–û–ì–†–ê–ú–ú–ï, –í–´ –û–ë–Ø–ó–ê–ù–´ –ó–ê–î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨ –í–°–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï –ò –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú –í–û–ó–ú–û–ñ–ù–û–°–¢–¨ –ü–û–õ–£–ß–ò–¢–¨ –ò–°–•–û–î–ù–ò–ö–ò –í–ê–®–ï–ô –ö–û–ü–ò–ò –ü–†–û–ì–†–ê–ú–ú–´, –ê –¢–ê–ö–ñ–ï –£–ö–ê–ó–ê–¢–¨ –ê–í–¢–û–†–°–¢–í–û –î–ê–ù–ù–û–ì–û –ü–†–û–ì–†–ê–ú–ú–ù–û–ì–û –û–ë–ï–°–ü–ï–ß–ï–ù–ò–Ø
#–ü–†–ò –†–ê–°–ü–†–û–°–¢–†–ê–ù–ï–ù–ò–ò –ü–†–û–ì–†–ê–ú–ú–´ –í–´ –û–ë–Ø–ó–ê–ù–´ –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –í–°–ï –¢–ï–ñ–ï –ü–†–ê–í–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ –ß–¢–û –ò –ú–´ –í–ê–ú, –ê –¢–ê–ö–ñ–ï –õ–ò–¶–ï–ù–ó–ò–Ø GPL v3
#–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –ª–∏—Ü–µ–Ω–∑–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –§–æ–Ω–¥–∞ –°–≤–æ–±–æ–¥–Ω–æ–≥–æ –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –û–±–µ—Å–ø–µ—á–µ–Ω–∏—è - https://www.gnu.org/licenses/gpl-3.0.html
#–ò–ª–∏ –≤ —Ñ–∞–π–ª–µ COPYING.txt –≤ –∞—Ä—Ö–∏–≤–µ —Å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–æ–º
#Copyleft üÑØ NEO Organization, Departament K 2024 - 2025
#Coded by @AnonimNEO (Telegram)

#–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
import tkinter as tk

#–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –û—à–∏–±–æ–∫
from loguru import logger
#–†–∞–±–æ—Ç–∞ —Å –≤—Ä–µ–º–µ–Ω–∏–º
import time
#–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –û–°
import ast
import os

from RS import random_string
from CC22 import CC22
from config import *

global load_protection_version, debug_mode, time_sleep_to_close_question, time_sleep_to_close_question2
load_protection_version = "2.2.12 Alpha"
debug_mode = True

def LP(run_in_recovery, debug_mode=False):
    if not run_in_recovery:
        import psutil
    else:
        psutil = Psutil()

    if not run_in_recovery:
        from EC import EC, get_process_critical_status
    else:
        def EC(i, c, d):
            pass
        def get_process_critical_status(i):
            return False

    def read_data_file(file, code):
        if not os.path.exists(file):
            if debug_mode:
                logger.info(f"LP - —Ñ–∞–π–ª–∞ {file} –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.")
            return exception_process
        try:
            with open(file, "r") as data:
                data_file = data.read()
            data_file_decrypt = CC22(str(data_file), code, True)
            data_list = ast.literal_eval(data_file_decrypt)
        except FileNotFoundError:
            data_list = []
            if debug_mode:
                logger.error(f"LP - —Ñ–∞–π–ª {file}, –≤–Ω–µ–∑–∞–ø–Ω–æ –∏—Å—á–µ–∑!")
        except Exception as e:
            data_list = []
            logger.error(f"LP - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ read_data_file!\n{e}")

        return exception_process + data_list

    def save_data_file(file, code, process_name):
        if not os.path.exists(file):
            try:
                with open(file, "w") as data:
                    data.write('[""')
            except Exception as e:
                logger.error(f"LP - –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ñ–∞–π–ª–∞ {file}, –≤ —Ñ—É–Ω–∫—Ü–∏–∏ cript_data_file\n{e}")
                return False
        try:
            with open(file, "r") as data:
                data_file = data.read()
            cript_process_name = CC22(process_name, code)
            if data_file:
                if data_file.endswith("]\n"):
                    data_file = data_file[:-2]
                elif data_file.endswith("]"):
                    data_file = data_file[:-1]
                else:
                    with open(file, "w") as data:
                        data.write('[""')
            with open(file, "w") as data:
                data.write(f'{data_file}, "{cript_process_name}"]')
            return True
        except FileNotFoundError:
            logger.error(f"LP - —Ñ–∞–π–ª {file}, –≤–Ω–µ–∑–∞–ø–Ω–æ –∏—Å—á–µ–∑!")
        except Exception as e:
            logger.error(f"LP - –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª {file}:\n{e}")

    #–í–æ–ø—Ä–æ—Å —Å–ª–µ–¥—É—é—â–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞–¥ –ø—Ä–æ—Ü–µ—Å—Å–æ–º
    def question_process(process_name, process_id, cause, text, time_to_close_question):
        LP_PQ = tk.Tk()
        LP_PQ.withdraw()

        #–°–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
        dialog = tk.Toplevel(LP_PQ)
        dialog.title(random_string())

        tk.Label(dialog, text=text, wraplength=400, justify=tk.LEFT, padx=10, pady=10).pack()

        #–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
        if cause == "name" or cause == "load":
            auto_action = "ignore"
            action_text = "–ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω"
        elif cause == "resume":
            auto_action = "ignore"
            action_text = "–ù–ï –¥–æ–±–∞–≤–ª–µ–Ω –≤ –±–∞–∑—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π"

        #–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è –≤—Ä–µ–º–µ–Ω–∏
        remaining_time = tk.IntVar(value=time_to_close_question)

        #Label –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞
        timer_text_label = tk.Label(dialog,
                                    text=f"–ü—Ä–æ—Ü–µ—Å—Å {process_name} –±—É–¥–µ—Ç {action_text} –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ {remaining_time.get()} —Å–µ–∫.",
                                    fg="gray",
                                    wraplength=400,
                                    justify=tk.CENTER,
                                    pady=5)
        timer_text_label.pack()

        #–ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—ã–±–æ—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        user_choice = tk.StringVar(value=auto_action) #–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ-–¥–µ–π—Å—Ç–≤–∏–µ –∫–∞–∫ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        #–ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ
        def close_dialog(action=auto_action):
            if dialog.winfo_exists(): #–ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ–∫–Ω–æ –µ—â–µ –Ω–µ –∑–∞–∫—Ä—ã—Ç–æ
                user_choice.set(action)
                dialog.destroy()
                LP_PQ.quit()
            else:
                pass

        #–û–±–Ω–æ–≤–ª—è–µ–º –¢–∞–π–º–µ—Ä
        def update_timer():
            #–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –µ—â–µ –≤–∏–¥–∂–µ—Ç –ø–µ—Ä–µ–¥ –ø–æ–ø—ã—Ç–∫–æ–π –µ–≥–æ –æ–±–Ω–æ–≤–∏—Ç—å
            if not timer_text_label.winfo_exists():
                if debug_mode:
                    logger.info("LP - –í–∏–¥–∂–µ—Ç —Ç–∞–π–º–µ—Ä–∞ —É–∂–µ –∑–∞–∫—Ä—ã—Ç. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.")
                return #–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –≤—ã–∑–æ–≤

            current_time = remaining_time.get()
            if current_time > 0:
                remaining_time.set(current_time - 1)
                #–û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω–µ
                timer_text_label.config(
                    text=f"–ü—Ä–æ—Ü–µ—Å—Å {process_name} –±—É–¥–µ—Ç {action_text}, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ {remaining_time.get()} —Å–µ–∫.")
                LP_PQ.after(1000, update_timer)
            else:
                #–í—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ
                close_dialog(auto_action)

        #–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏—á–∏–Ω—ã —Ñ–æ—Ä–º–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
        if cause == "name" or cause == "load":
            #–ö–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞
            tk.Button(dialog, text="–†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å", command=lambda: close_dialog("resume")).pack(
                side=tk.LEFT, padx=5, pady=10)
            tk.Button(dialog, text=f"–ó–∞–∫—Ä—ã—Ç—å (–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å: {get_process_critical_status(process_id)})",
                      command=lambda: close_dialog("kill")).pack(side=tk.LEFT,
                                                                 padx=5, pady=10)
            tk.Button(dialog, text="–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å", command=lambda: close_dialog("ignore")).pack(side=tk.LEFT,
                                                                                                padx=5, pady=10)
        elif cause == "resume":
            #–ö–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ —Ä–∞–∑–º–æ—Ä–æ–∑–∫–∏
            tk.Button(dialog, text="–î–∞, –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏—Å–∫–ª—é—á–µ–Ω–∏—è", command=lambda: close_dialog("add_exception")).pack(
                side=tk.LEFT, padx=5, pady=10)
            tk.Button(dialog, text="–ù–µ—Ç, –Ω–µ –¥–æ–±–∞–≤–ª—è—Ç—å", command=lambda: close_dialog("ignore")).pack(side=tk.LEFT,
                                                                                                     padx=5,
                                                                                                     pady=10)

        #–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–∫–Ω–∞
        dialog.update_idletasks()
        width = dialog.winfo_width()
        height = dialog.winfo_height()
        x = (dialog.winfo_screenwidth() // 2) - (width // 2)
        y = (dialog.winfo_screenheight() // 2) - (height // 2)
        dialog.geometry(f"{width}x{height}+{x}+{y}")

        #–ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞
        if time_to_close_question > 0:
            LP_PQ.after(1000, update_timer)

        LP_PQ.mainloop()

        return user_choice.get()

    def action_process(process_id, name_process, action, cause, text):
        if debug_mode:
            logger.info(f"LP - ID –ü—Ä–æ—Ü–µ—Å—Å–∞: {process_id}, –ò–º—è: {name_process}")
            logger.info(f"LP - –î–µ–π—Å—Ç–≤–∏–µ: {action}, –ü—Ä–∏—á–∏–Ω–∞: {cause}")
            logger.info(f"LP - –°–æ–æ–±—â–µ–Ω–∏–µ: {text}")

        if action == "suspend":
            try:
                process = psutil.Process(process_id)
                process.suspend()
            except Exception as e:
                logger.critical(f"LP - –ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å {name_process} (PID: {process_id}):\n{e}")
                return False

            #–í—ã–∑–æ–≤ –æ–∫–Ω–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user_decision = question_process(name_process, process_id, cause, text, time_sleep_to_close_question)
            logger.info(f"LP - –î–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ {name_process} (PID: {process_id}), –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–π –ø–æ –ø—Ä–∏—á–∏–Ω–µ {cause}, –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ: {user_decision}")

            if user_decision == "kill":
                process = psutil.Process(process_id)
                process.terminate()
                logger.info(f"LP - –ü—Ä–æ—Ü–µ—Å—Å {name_process} (PID: {process_id}) —É–±–∏—Ç.")
                return True
            elif user_decision == "resume":
                action_process(process_id, name_process, "resume", "resume",
                               f"LP - –ü—Ä–æ—Ü–µ—Å—Å {name_process} —Ä–∞–∑–º–æ—Ä–æ–∂–µ–Ω. –í—ã —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å –µ–≥–æ –≤ –±–∞–∑—É –∏—Å–∫–ª—é—á–µ–Ω–∏–π?")
                return False  #–ù–µ —É–¥–∞–ª—è–µ–º –∏–∑ –ø—É–ª–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω —Ä–∞–∑–º–æ—Ä–æ–∂–µ–Ω
            elif user_decision == "add_exception":
                save_data_file(exception_process_txt, clyth, name_process)
                read_data_file(exception_process_txt, clyth)
                return True
            elif user_decision == "ignore":
                #–ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è, –æ–Ω –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –∏–∑ –ø—É–ª–∞
                #–ò–Ω–∞—á–µ –æ–Ω –∏—Å—á–µ–∑–Ω–µ—Ç –∏ –Ω–µ –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –Ω–∞ –Ω–∞–≥—Ä—É–∑–∫—É
                return False

            #–ï—Å–ª–∏ –Ω–µ "kill", –Ω–µ "add_exception", –∏ –Ω–µ "ignore" (–Ω–∞–ø—Ä–∏–º–µ—Ä, "resume"),
            #–∏ –ø—Ä–æ—Ü–µ—Å—Å –±—ã–ª —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–º–æ—Ä–æ–∂–µ–Ω (action_process(resume)), —Ç–æ –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º False,
            #—á—Ç–æ–±—ã –æ–Ω –æ—Å—Ç–∞–ª—Å—è –≤ –ø—É–ª–µ (–¥–µ–π—Å—Ç–≤–∏–µ "resume" –Ω–µ —É–±–∏–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å).
            #–ï—Å–ª–∏ –±—ã–ª–æ –≤—ã–±—Ä–∞–Ω–æ "kill" –∏–ª–∏ "add_exception", –º—ã –≤–µ—Ä–Ω–µ–º True
            return True if user_decision == "kill" or user_decision == "add_exception" else False

        elif action == "resume":
            try:
                process = psutil.Process(process_id)
                process.resume()
            except Exception as e:
                logger.error(f"LP - –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å {name_process} (PID: {process_id}):\n{e}")
                return False

            user_decision = question_process(name_process, process_id, cause, text, time_sleep_to_close_question2)

            if user_decision == "add_exception":
                save_data_file(exception_process_txt, clyth, name_process)
                read_data_file(exception_process_txt, clyth)
                return True
            return False
        return False



    #–ü–æ–ª—É—á–∞–µ–º –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ RAN
    def get_ram_percentage(process_id, process_name):
        try:
            process = psutil.Process(process_id)
            process_mem_bytes = process.memory_info().rss
            mb_ram = process_mem_bytes / (1024 * 1024)

            return (process_mem_bytes / total_ram) * 100

            #–û–∫—Ä—É–≥–ª—è–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç –¥–æ 2 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π, –ú–ë - –¥–æ —Ü–µ–ª–æ–≥–æ —á–∏—Å–ª–∞
            ram_percent_str = f"{ram_percent:.2f}"
            mb_ram_str = f"{mb_ram:.0f}"

            #–í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É –≤ —Ç—Ä–µ–±—É–µ–º–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
            return f"{ram_percent_str} {mb_ram_str}"
        except psutil.NoSuchProcess:
            if debug_mode:
                logger.error(f"LP - –ü—Ä–æ—Ü–µ—Å—Å {process_name} (PID: {process_id}) –∑–∞–∫—Ä—ã–ª—Å—è –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏")
        except PermissionError:
            logger.error(f"LP - –û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ RAM –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ {process_name} (PID: {process_id})")
        except Exception as e:
            logger.critical(f"LP - –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ RAM  –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ {process_name} (PID: {process_id})\n{e}")



    #–£–¥–∞–ª—è–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ –≤ –∏–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
    def get_base_name(name):
        return name.rsplit(".", 1)[0]

    #–ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
    def get_all_processes():
        if debug_mode:
            logger.info(f"LP - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤...")
        try:
            return list(psutil.process_iter(["pid", "name"]))
        except psutil.AccessDenied:
            logger.critical(f"LP - –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Å–ø–∏—Å–∫—É –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.")
            return False

    #–û—Ç—Å–µ–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã –∏–∑ –±–∞–∑—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π
    def filter_exceptions(processes, exceptions):
        if debug_mode:
            logger.info(f"LP - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π...")
        filtered_processes = [p for p in processes if p.info["name"] not in exceptions]
        return filtered_processes

    #–ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–æ –±–∞–∑–µ
    def check_bad_names(processes, bad_names):
        if debug_mode:
            logger.info(f"LP - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ –ø–æ –±–∞–∑–µ...")
        rest_processes = []

        for p in processes:
            process_name = p.info["name"]
            process_name_lower = process_name.lower() #–ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–ª–Ω–æ–µ –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ –Ω–∏–∂–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ
            process_id = p.info["pid"]

            is_bad = False
            for bad_word in bad_names:
                #–ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ª–∏ "–ø–ª–æ—Ö–æ–µ" —Å–ª–æ–≤–æ –≤ –ø–æ–ª–Ω–æ–º –∏–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
                if bad_word.lower() in process_name_lower:
                    text = f'–ü—Ä–æ—Ü–µ—Å—Å {process_name} –∑–∞–º–æ—Ä–æ–∂–µ–Ω –∏–∑-–∑–∞ –µ–≥–æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏. –ò–∑-–∑–∞ —Å–ª–æ–≤–∞ "{bad_word}".'
                    #action_process –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–±–∏—Ç –∏–ª–∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω
                    if action_process(process_id, process_name, "suspend", "name", text):
                        logger.info(f"LP - –ü—Ä–æ—Ü–µ—Å—Å {process_name} (PID: {process_id}) —É–¥–∞–ª–µ–Ω –∏–∑ –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø—É–ª–∞.")
                        is_bad = True
                        break

            if not is_bad:
                rest_processes.append(p)

        return rest_processes



    #–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–≥—Ä—É–∑–∫—É –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –Ω–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ü–ö
    def check_resource_load(processes):
        for p in processes:
            process_name = p.info["name"]
            process_id = p.info["pid"]
            is_high_load = False

            try:
                #–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
                cpu_percent = p.cpu_percent(interval=0.1) #–ò–Ω—Ç–µ—Ä–≤–∞–ª –Ω—É–∂–µ–Ω –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
                ram_mb = p.memory_info().rss / (1024 * 1024)
                ram_percent = get_ram_percentage(process_id, process_name)

                #–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –ø–æ—Ä–æ–≥–∞ CPU
                if cpu_percent > ultimate_load_cpu:
                    text = f"–ü—Ä–æ—Ü–µ—Å—Å {process_name} –∏–∑–±—ã—Ç–æ—á–Ω–æ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –Ω–∞ {cpu_percent:.2f}%."
                    if action_process(process_id, process_name, "suspend", "load", text):
                        is_high_load = True

                #–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä–æ–≥–∞ RAM (–µ—Å–ª–∏ –µ—â—ë –Ω–µ –∑–∞–º–æ—Ä–æ–∂–µ–Ω)
                if not is_high_load:
                    if ram_percent > ultimate_load_ram:
                        text = f"–ü—Ä–æ—Ü–µ—Å—Å {process_name} –∏–∑–±—ã—Ç–æ—á–Ω–æ –Ω–∞–≥—Ä—É–∂–∞–µ—Ç –û–ø–µ—Ä–∞—Ç–∏–≤–Ω—É—é –ü–∞–º—è—Ç—å –Ω–∞ {ram_percent:.2f}% ({ram_mb:.2f} MB)."
                        if action_process(process_id, process_name, "suspend", "load", text):
                            is_high_load = True

            except psutil.NoSuchProcess:
                #–ü—Ä–æ—Ü–µ—Å—Å –º–æ–≥ –∑–∞–∫—Ä—ã—Ç—å—Å—è, –ø–æ–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞
                if debug_mode:
                    logger.error(f"LP - –ü—Ä–æ—Ü–µ—Å—Å {process_name} (PID: {process_id}) –∑–∞–∫—Ä—ã–ª—Å—è –≤–æ –≤—Ä–µ–º—è –ø—Ä–æ–≤–µ—Ä–∫–∏.")
            except psutil.AccessDenied:
                pass
            except Exception as e:
                logger.critical(f"LP - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ {process_name} (PID: {process_id}):\n{e}")
                pass
        return True


    try:
        if debug_mode:
            logger.info(f"LP - –í–ö–õ–Æ–ß–ï–ù DEBUG –ú–û–î")
        global exception_process, bad_process, total_ram
        total_ram = psutil.virtual_memory().total
        exception_process = read_data_file(exception_process_txt, clyth)
        bad_process = read_data_file(bad_process_txt, clyth)
        while True:
            #–ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
            all_processes = get_all_processes()

            #–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π
            filtered_processes = filter_exceptions(all_processes, exception_process)

            #–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–ª–æ—Ö–∏–µ –∏–º–µ–Ω–∞
            processes_after_name_check = check_bad_names(filtered_processes, bad_process)

            #–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏–∑–±—ã—Ç–æ—á–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É
            check_resource_load(processes_after_name_check)
            time.sleep(time_sleep_to_scan)
    except Exception as e:
        logger.critical("LP - –í –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–µ LoadProtection –ø—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞!")