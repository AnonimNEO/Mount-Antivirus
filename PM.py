#–î–∞–Ω–Ω–æ–µ –°–≤–æ–±–æ–¥–Ω–æ–µ –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ GPL-3.0-only –∏–ª–∏ GPL-3.0-or-later
#–í—ã –∏–º–µ–µ—Ç–µ –ø—Ä–∞–≤–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è—Ç—å, –≤–∑–∏–º–∞—Ç—å –ø–ª–∞—Ç—É –∑–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∞–∫—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∫–æ–ø–∏–∏, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Å–≤–æ–µ–º—É —É—Å–º–æ—Ç—Ä–µ–Ω–∏—é –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –≥–∞—Ä–∞–Ω—Ç–∏–π–Ω—É—é –∑–∞—â–∏—Ç—É –≤ –æ–±–º–µ–Ω –Ω–∞ –ø–ª–∞—Ç—É
#–î–õ–Ø –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø –î–ê–ù–ù–û–ì–û –°–í–û–ë–û–î–ù–û–ì–û –ü–†–û–ì–†–ê–ú–ú–ù–û–ì–û –û–ë–ï–°–ü–ï–ß–ï–ù–ò–Ø, –í–ê–ú –ù–ï –¢–†–ï–ë–£–ï–¢–°–Ø –ü–†–ò–ù–Ø–¢–ò–ï –õ–ò–¶–ï–ù–ó–ò–ò Gnu GPL v3.0 –∏–ª–∏ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω–µ–π –≤–µ—Ä—Å–∏–∏
#–í –°–õ–£–ß–ê–ï –†–ê–°–ü–†–û–°–¢–†–ê–ù–ï–ù–ò–Ø –û–†–ò–ì–ò–ù–ê–õ–¨–ù–û–ô –ü–†–û–ì–†–ê–ú–ú–´ –ò/–ò–õ–ò –ú–û–î–ï–†–ù–ò–ó–ò–†–û–í–ê–ù–ù–û–ô –í–ï–†–°–ò–ò –ò/–ò–õ–ò –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ò–°–•–û–î–ù–ò–ö–û–í –í –°–í–û–ï–ô –ü–†–û–ì–†–ê–ú–ú–ï, –í–´ –û–ë–Ø–ó–ê–ù–´ –ó–ê–î–û–ö–£–ú–ï–ù–¢–ò–†–û–í–ê–¢–¨ –í–°–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î–ï –ò –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø–ú –í–û–ó–ú–û–ñ–ù–û–°–¢–¨ –ü–û–õ–£–ß–ò–¢–¨ –ò–°–•–û–î–ù–ò–ö–ò –í–ê–®–ï–ô –ö–û–ü–ò–ò –ü–†–û–ì–†–ê–ú–ú–´, –ê –¢–ê–ö–ñ–ï –£–ö–ê–ó–ê–¢–¨ –ê–í–¢–û–†–°–¢–í–û –î–ê–ù–ù–û–ì–û –ü–†–û–ì–†–ê–ú–ú–ù–û–ì–û –û–ë–ï–°–ü–ï–ß–ï–ù–ò–Ø
#–ü–†–ò –†–ê–°–ü–†–û–°–¢–†–ê–ù–ï–ù–ò–ò –ü–†–û–ì–†–ê–ú–ú–´ –í–´ –û–ë–Ø–ó–ê–ù–´ –ü–†–ï–î–û–°–¢–ê–í–ò–¢–¨ –í–°–ï –¢–ï–ñ–ï –ü–†–ê–í–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Æ –ß–¢–û –ò –ú–´ –í–ê–ú, –ê –¢–ê–ö–ñ–ï –õ–ò–¶–ï–ù–ó–ò–Ø GPL v3
#–ü—Ä–æ—á–∏—Ç–∞—Ç—å –ø–æ–ª–Ω—É—é –≤–µ—Ä—Å–∏—é –ª–∏—Ü–µ–Ω–∑–∏–∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ –§–æ–Ω–¥–∞ –°–≤–æ–±–æ–¥–Ω–æ–≥–æ –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –û–±–µ—Å–ø–µ—á–µ–Ω–∏—è - https://www.gnu.org/licenses/gpl-3.0.html
#–ò–ª–∏ –≤ —Ñ–∞–π–ª–µ COPYING.txt –≤ –∞—Ä—Ö–∏–≤–µ —Å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–æ–º
#Copyleft üÑØ NEO Organization, Departament K 2024 - 2025
#Coded by @AnonimNEO (Telegram)

#–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
from tkinter import ttk, messagebox, simpledialog
import tkinter as tk
#–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
from loguru import logger

from config import *
from OF import Psutil
from RS import random_string

process_manager_version = "1.5.3 Beta"

GUI_ELEMENTS = {
    "manager": None,
    "notebook": None,
    "tree": None,
    "tabs": {},
    "vsb": None,
    "current_tab": "–í—Å–µ –ü—Ä–æ—Ü–µ—Å—Å—ã",
    "treeview_data": [],
    "update_interval": time_to_update_process_list * 1000,
    "sort_column": "PID",
    "sort_direction": "asc", #–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏: "asc" (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é) –∏–ª–∏ "desc" (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
    "search_query": ""
}



def PM(run_in_recovery):
    if not run_in_recovery:
        import psutil
        from EC import EC, get_process_critical_status
    else:
        psutil = Psutil()
        def EC(i, c, d):
            pass
        def get_process_critical_status(i, r):
            return False



    try:
        #–û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É
        def update_list():
            set_treeview_columns(GUI_ELEMENTS)
            load_current_tab_data(GUI_ELEMENTS)



        #–ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞
        def get_process_name(process_id):
            process = psutil.Process(process_id)
            return process.name()



        #–ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
        def get_process_info(proc):
            try:
                status = "–ó–∞–º–æ—Ä–æ–∂–µ–Ω" if proc.status() == psutil.STATUS_STOPPED else "–ó–∞–ø—É—â–µ–Ω"

                is_elevated = False
                #–†–ï–ê–õ–ò–ó–û–í–ê–¢–¨ –ü–†–û–í–ï–†–ö–£ –ù–ê –¢–û –ó–ê–ü–£–©–ï–ù –õ–ò –ü–†–û–¶–ï–°–° –û–¢ –ò–ú–ï–ù–ò –ê–î–ú–ò–ù–ò–°–¢–†–ê–¢–û–†–ê

                return {
                    "PID": proc.pid,
                    "–ò–º—è –ü—Ä–æ—Ü–µ—Å—Å–∞": proc.name(),
                    "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É": proc.exe() if proc.exe() else "–ù/–î",
                    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å": proc.username() if proc.username() else "–ù/–î",
                    "–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å": get_process_critical_status(proc.pid, run_in_recovery),
                    "–°—Ç–∞—Ç—É—Å": status,
                    "–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä": is_elevated,
                }
            except (psutil.NoSuchProcess, psutil.AccessDenied):
                return None
            except Exception as e:
                process_name = get_process_name(proc.pid)
                logger.error(f"PM - –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–æ—Ü–µ—Å—Å–µ {process_name} (pid:{proc.pid}):\n{e}")
                return None



        #–ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        def get_process_list(list_type):
            all_processes = []
            for proc in psutil.process_iter(["pid", "name", "exe", "username", "status"]):
                info = get_process_info(proc)
                if info:
                    all_processes.append(info)

            if list_type == "all_list":
                return all_processes
            elif list_type == "critical_list":
                return [p for p in all_processes if p["–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å"]]
            elif list_type == "suspend_list":
                return [p for p in all_processes if p["–°—Ç–∞—Ç—É—Å"] == "–ó–∞–º–æ—Ä–æ–∂–µ–Ω"]
            return []



        def filter_data_by_search(data, query):
            if not query:
                return data #–ï—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞ –ø—É—Å—Ç–∞—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ

            lower_query = query.lower()
            filtered_data = []

            #–ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å
            for item in data:
                found = False
                #–ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –≤—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
                for value in item.values():
                    #–ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –≤ –ª—é–±–æ–º —Å—Ç–æ–ª–±—Ü–µ
                    if lower_query in str(value).lower():
                        found = True
                        break
                if found:
                    filtered_data.append(item)

            return filtered_data



        #–î–∏–∞–ª–æ–≥ –ü–æ–∏—Å–∫–∞
        def open_search_dialog(gui_elements):
            manager = gui_elements["manager"]

            #–°–æ–∑–¥–∞–µ–º –¥–æ—á–µ—Ä–Ω–µ–µ –æ–∫–Ω–æ (Toplevel)
            search_window = tk.Toplevel(manager)
            search_window.title("–ü–æ–∏—Å–∫")
            search_window.geometry("300x100")
            search_window.resizable(False, False)
            #–î–µ–ª–∞–µ–º –æ–∫–Ω–æ –º–æ–¥–∞–ª—å–Ω—ã–º (–ø–æ–∫–∞ –æ–Ω–æ –æ—Ç–∫—Ä—ã—Ç–æ, –Ω–µ–ª—å–∑—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –æ—Å–Ω–æ–≤–Ω—ã–º –æ–∫–Ω–æ–º
            search_window.grab_set()

            #–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–∫–Ω–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
            manager_x = manager.winfo_x()
            manager_y = manager.winfo_y()
            manager_width = manager.winfo_width()
            manager_height = manager.winfo_height()

            x = manager_x + (manager_width // 2) - 150
            y = manager_y + (manager_height // 2) - 50
            search_window.geometry(f"+{x}+{y}")

            tk.Label(search_window, text="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞:").pack(pady=5, padx=10, anchor="w")

            #–¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ —Å –Ω–∞—á–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º
            search_text = tk.StringVar(value=gui_elements["search_query"])
            search_entry = ttk.Entry(search_window, textvariable=search_text, width=40)
            search_entry.pack(pady=5, padx=10)

            #–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
            search_entry.focus_set()

            def perform_search():
                #–°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ–∏—Å–∫–∞ –≤ –≥–ª–æ–±–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ GUI_ELEMENTS
                gui_elements["search_query"] = search_text.get()
                #–ó–∞–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –ø–æ–∏—Å–∫–∞
                search_window.destroy()
                #–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
                load_current_tab_data(gui_elements)

            def cancel_search():
                search_window.destroy()

            button_frame = ttk.Frame(search_window)
            button_frame.pack(pady=10)

            ttk.Button(button_frame, text="–û—Ç–º–µ–Ω–∞", command=cancel_search).pack(side="left", padx=5)
            ttk.Button(button_frame, text="–û–ö", command=perform_search).pack(side="left", padx=5)

            #–ü—Ä–∏–≤—è–∑–∫–∞ Enter –∫ –∫–Ω–æ–ø–∫–µ "–û–ö"
            search_window.bind("<Return>", lambda e: perform_search())
            #–ü—Ä–∏–≤—è–∑–∫–∞ Esc –∫ –∫–Ω–æ–ø–∫–µ "–û—Ç–º–µ–Ω–∞"
            search_window.bind("<Escape>", lambda e: cancel_search())

            #–û–∂–∏–¥–∞–µ–º –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞
            manager.wait_window(search_window)



        #–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ü–æ–∏—Å–∫
        def stop_search(gui_elements):
            #–ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –ø–æ–∏—Å–∫ –≤–æ–æ–±—â–µ
            if gui_elements["search_query"] == "":
                return #–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –µ—Å–ª–∏ –ø–æ–∏—Å–∫ –∏ —Ç–∞–∫ –ø—É—Å—Ç

            #–°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç—Ä–æ–∫—É –ø–æ–∏—Å–∫–∞
            gui_elements["search_query"] = ""
            #–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞
            load_current_tab_data(gui_elements)



        #–î–µ–π—Å—Ç–≤–∏–µ —Å –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏
        def action_process(gui_elements, action, process_id):
            try:
                proc = psutil.Process(process_id)

                if action == "kill":
                    proc.terminate()

                elif action == "suspend":
                    proc.suspend()

                elif action == "resume":
                    proc.resume()

                elif action == "edit_critical_to_false":
                    EC(process_id, False)

                elif action == "edit_critical_to_true":
                    EC(process_id, True)

                #–û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ—Å–ª–µ –¥–µ–π—Å—Ç–≤–∏—è
                gui_elements["manager"].after(100, lambda: load_current_tab_data(gui_elements))

            except psutil.NoSuchProcess:
                pass
            except psutil.AccessDenied:
                pass
            except Exception as e:
                process_name = get_process_name(process_id)
                logger.critical(f"PM - –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ {action} –¥–ª—è {process_name} (pid: {process_id}):\n{e}")



        #–û –ü—Ä–æ–≥—Ä–∞–º–º–µ
        def about_PM():
            messagebox.showinfo(random_string(), f"–ú–µ–Ω–µ–¥–∂–µ—Ä –ü—Ä–æ—Ü–µ—Å—Å–æ–≤ - {process_manager_version}")



        #–°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ
        def sort_data(data, col, direction):
            #–°–ª–æ–≤–∞—Ä—å –¥–ª—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è —Å—Ç–æ–ª–±—Ü–æ–≤ –≤ –∫–ª—é—á–∏, –ø–æ –∫–æ—Ç–æ—Ä—ã–º –Ω—É–∂–Ω–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
            key_map = {
                "PID": "PID",
                "–ò–º—è –ü—Ä–æ—Ü–µ—Å—Å–∞": "–ò–º—è –ü—Ä–æ—Ü–µ—Å—Å–∞",
                "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É": "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É",
                "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                "–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å": "–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å",
                "–°—Ç–∞—Ç—É—Å": "–°—Ç–∞—Ç—É—Å",
            }

            #–ü–æ–ª—É—á–∞–µ–º —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∫–ª—é—á –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            sort_key = key_map.get(col)

            if not sort_key:
                return data

            #–û–ø—Ä–µ–¥–µ–ª—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∫–ª—é—á —á–∏—Å–ª–æ–≤—ã–º, —á—Ç–æ–±—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ
            is_numeric = sort_key in ["PID"]

            def sort_func(item):
                value = item.get(sort_key, "")
                if is_numeric:
                    try:
                        return int(value)
                    except ValueError:
                        return 0 #–í–æ–∑–≤—Ä–∞—â–∞–µ–º 0, –µ—Å–ª–∏ –Ω–µ —É–¥–∞–µ—Ç—Å—è –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ —á–∏—Å–ª–æ
                return value

            #–°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ. reverse=True, –µ—Å–ª–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ 'desc' (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            data.sort(key=sort_func, reverse=(direction == "desc"))
            return data



        #–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–º–µ–Ω—ã –≤–∫–ª–∞–¥–∫–∏
        def on_tab_change(event, gui_elements):
            selected_tab = gui_elements["notebook"].tab(gui_elements["notebook"].select(), "text")
            if selected_tab != gui_elements["current_tab"]:
                gui_elements["current_tab"] = selected_tab
                #—Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–ª—è –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
                gui_elements["sort_column"] = "PID"
                gui_elements["sort_direction"] = "asc"
                set_treeview_columns(gui_elements)
                #–û—Ç–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö
                if "after_id" in gui_elements and gui_elements["after_id"] is not None:
                    gui_elements["manager"].after_cancel(gui_elements["after_id"])
                load_current_tab_data(gui_elements)



        #–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–æ–ª–±–∏–∫–æ–≤, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤–∫–ª–∞–¥–∫–∏
        def set_treeview_columns(gui_elements):
            #–£–¥–∞–ª—è–µ–º –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –∏ —Å–∫—Ä–æ–ª–ª–±–∞—Ä –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏
            if gui_elements["tree"] and gui_elements["tree"].winfo_exists():
                gui_elements["tree"].destroy()
            if gui_elements["vsb"] and gui_elements["vsb"].winfo_exists():
                gui_elements["vsb"].pack_forget()

            current_frame = gui_elements["tabs"][gui_elements["current_tab"]]

            gui_elements["tree"] = ttk.Treeview(current_frame, selectmode="browse")
            gui_elements["tree"].pack(side="left", fill="both", expand=True)

            gui_elements["vsb"] = ttk.Scrollbar(current_frame, orient="vertical", command=gui_elements["tree"].yview)
            gui_elements["vsb"].pack(side="right", fill="y")
            gui_elements["tree"].configure(yscrollcommand=gui_elements["vsb"].set)

            #–ü—Ä–∏–≤—è–∑–∫–∞ –ü–ö–ú
            gui_elements["tree"].bind("<Button-3>", lambda e: handle_right_click(e, gui_elements))

            #–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            style = ttk.Style()
            style.configure("Treeview", rowheight=25)
            style.map("Treeview", background=[("selected", "blue")])

            #–ö—Ä–∏—Ç–∏—á–Ω—ã–π
            gui_elements["tree"].tag_configure("critical", background="red", foreground="white")
            #–ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–π
            gui_elements["tree"].tag_configure("suspended", background="gray", foreground="white")
            #–ê–¥–º–∏–Ω
            gui_elements["tree"].tag_configure("admin", background="orange", foreground="black")

            columns = ("PID", "–ò–º—è –ü—Ä–æ—Ü–µ—Å—Å–∞", "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É", "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å", "–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å", "–°—Ç–∞—Ç—É—Å")
            headings = dict(zip(columns, columns))

            gui_elements["tree"]["columns"] = columns
            gui_elements["tree"]["show"] = "headings"

            #–î–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É
            def sort_column_data(col):
                #–ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ —Ç–æ—Ç –∂–µ —Å—Ç–æ–ª–±–µ—Ü, –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
                if gui_elements["sort_column"] == col:
                    gui_elements["sort_direction"] = "desc" if gui_elements["sort_direction"] == "asc" else "asc"
                else:
                    #–ò–Ω–∞—á–µ, —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (asc)
                    gui_elements["sort_column"] = col
                    gui_elements["sort_direction"] = "asc"

                #–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                load_current_tab_data(gui_elements)

            #–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —à–∏—Ä–∏–Ω—ã –∫–æ–ª–æ–Ω–æ–∫ –∏ –ø—Ä–∏–≤—è–∑–∫–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            col_widths = {"PID": 20, "–ò–º—è –ü—Ä–æ—Ü–µ—Å—Å–∞": 100, "–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É": 250, "–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å": 50, "–°—Ç–∞—Ç—É—Å": 35}
            for col in columns:
                heading_text = headings.get(col, col)
                #–î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∫ –∑–∞–≥–æ–ª–æ–≤–∫—É, –µ—Å–ª–∏ —ç—Ç–æ —Ç–µ–∫—É—â–∏–π —Å—Ç–æ–ª–±–µ—Ü
                if col == gui_elements["sort_column"]:
                    arrow = " ‚ñº" if gui_elements["sort_direction"] == "desc" else " ‚ñ≤"
                    heading_text += arrow

                gui_elements["tree"].heading(col, text=heading_text,
                                             command=lambda c=col: sort_column_data(c)) #–ü—Ä–∏–≤—è–∑—ã–≤–∞–µ–º –∫–æ–º–∞–Ω–¥—É —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
                gui_elements["tree"].column(col, width=col_widths.get(col, 150), anchor=tk.W)



        #–ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –≤–∫–ª–∞–¥–∫–∏ –∏ –∑–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É
        def load_current_tab_data(gui_elements):
            tree = gui_elements["tree"]
            current_tab = gui_elements["current_tab"]

            #—Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å, –≤—ã–¥–µ–ª–µ–Ω–∏–µ –∏ –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–∞
            #–ü–æ–ª—É—á–∞–µ–º PID –ø—Ä–æ—Ü–µ—Å—Å–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤ —Ñ–æ–∫—É—Å–µ/–≤—ã–±—Ä–∞–Ω
            saved_pid = None
            saved_scroll_pos = None #–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∑–∏—Ü–∏–∏ —Å–∫—Ä–æ–ª–ª–∞
            try:
                #focus() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç iid (PID) —ç–ª–µ–º–µ–Ω—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –≤ —Ñ–æ–∫—É—Å–µ
                focused_item_id = tree.focus()
                #selection() –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã—Ö iid
                selected_item_ids = tree.selection()

                #–°–æ—Ö—Ä–∞–Ω—è–µ–º PID, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
                if focused_item_id:
                    saved_pid = int(focused_item_id)
                elif selected_item_ids:
                    saved_pid = int(selected_item_ids[0])

                #–°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞
                saved_scroll_pos = tree.yview()[0]

            except Exception:
                pass

            #–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            raw_data = []
            if current_tab == "–í—Å–µ –ü—Ä–æ—Ü–µ—Å—Å—ã":
                raw_data = get_process_list("all_list")
            elif current_tab == "–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ü—Ä–æ—Ü–µ—Å—Å—ã":
                raw_data = get_process_list("critical_list")
            elif current_tab == "–ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ—Ü–µ—Å—Å—ã":
                raw_data = get_process_list("suspend_list")

            if raw_data is None:
                raw_data = []

            gui_elements["treeview_data"] = filter_data_by_search(raw_data, gui_elements["search_query"])

            gui_elements["treeview_data"] = filter_data_by_search(raw_data, gui_elements["search_query"])
            #–ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –ø–µ—Ä–µ–¥ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã
            gui_elements["treeview_data"] = sort_data(
                gui_elements["treeview_data"],
                gui_elements["sort_column"],
                gui_elements["sort_direction"]
            )
            #–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–æ–Ω–∫–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
            set_treeview_columns(gui_elements)

            tree = gui_elements["tree"]

            columns = gui_elements["tree"]["columns"]

            #–ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
            all_pids = []
            for PM_data in gui_elements["treeview_data"]:
                values = [str(PM_data.get(col, "")) for col in columns]
                unique_id = str(PM_data["PID"])
                all_pids.append(PM_data["PID"])

                tags = []
                if PM_data.get("–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å"):
                    tags.append("critical")
                if PM_data.get("–°—Ç–∞—Ç—É—Å") == "–ó–∞–º–æ—Ä–æ–∂–µ–Ω":
                    tags.append("suspended")
                if PM_data.get("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä"):
                    tags.append("admin")

                #iid (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–∞) —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–∫ PID
                tree.insert("", "end", values=values, tags=tuple(tags), iid=unique_id, open=True)

            focus_restored = False

            if saved_pid is not None:
                new_focus_id = str(saved_pid)

                #–ï—Å–ª–∏ PID –≤—Å–µ –µ—â–µ –≤ —Å–ø–∏—Å–∫–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
                if new_focus_id in tree.get_children():
                    #–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–∫—É—Å –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                    tree.focus(new_focus_id)
                    tree.selection_set(new_focus_id)
                    tree.see(new_focus_id) #–ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –¥–æ –Ω–µ–≥–æ
                    tree.focus_set()
                    focus_restored = False
                else:
                    #–≠–ª–µ–º–µ–Ω—Ç –ø—Ä–æ–ø–∞–ª. –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏–π.
                    try:
                        insertion_index = next(i for i, pid in enumerate(all_pids) if pid > saved_pid)

                        if insertion_index > 0:
                            #–ë–µ—Ä–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —ç–ª–µ–º–µ–Ω—Ç (–±–ª–∏–∂–∞–π—à–∏–π –º–µ–Ω—å—à–∏–π PID)
                            focus_pid = all_pids[insertion_index - 1]
                        else:
                            #–ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π
                            focus_pid = all_pids[0]

                        new_focus_id = str(focus_pid)

                        tree.focus(new_focus_id)
                        tree.selection_set(new_focus_id)
                        tree.see(new_focus_id)
                        tree.focus_set()
                        focus_restored = False

                    except (StopIteration, IndexError):
                        #–ï—Å–ª–∏ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç –∏–ª–∏ saved_pid –±—ã–ª –±–æ–ª—å—à–µ –≤—Å–µ—Ö, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª, –µ—Å–ª–∏ –µ—Å—Ç—å
                        if all_pids:
                            #–ë–µ—Ä–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π
                            last_pid = all_pids[-1]
                            new_focus_id = str(last_pid)
                            tree.focus(new_focus_id)
                            tree.selection_set(new_focus_id)
                            tree.see(new_focus_id)
                            tree.focus_set()
                            focus_restored = False

            if not focus_restored and saved_scroll_pos is not None:
                tree.yview_moveto(saved_scroll_pos)

            #–ï—Å–ª–∏ —Ñ–æ–∫—É—Å–∞ –Ω–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –∏–ª–∏ —Å–±—Ä–æ—Å), —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç
            if not tree.focus() and tree.get_children():
                first_item = tree.get_children()[0]
                tree.focus(first_item)
                tree.selection_set(first_item)
                tree.see(first_item) #–ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ –ø–µ—Ä–≤–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                tree.focus_set()

            #–ü–ª–∞–Ω–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
            #–≠—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø—Ä–∏–º–µ–Ω–∏—Ç —Ñ–∏–ª—å—Ç—Ä, –µ—Å–ª–∏ –æ–Ω —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
            if "after_id" in gui_elements and gui_elements["after_id"] is not None:
                gui_elements["manager"].after_cancel(gui_elements["after_id"])

            gui_elements["after_id"] = gui_elements["manager"].after(
            gui_elements["update_interval"],
            lambda: load_current_tab_data(gui_elements)
            )



        #–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –ú–µ–Ω—é
        def show_context_menu(event, gui_elements, PM_data, item_id):
            manager = gui_elements["manager"]
            current_tab = gui_elements["current_tab"]

            menu = tk.Menu(manager, tearoff=0)

            if PM_data:
                process_path = PM_data["–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É"]
                process_name = PM_data["–ò–º—è –ü—Ä–æ—Ü–µ—Å—Å–∞"]
                critical_state = "–ö—Ä–∏—Ç–∏—á–Ω—ã–π" if PM_data["–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å"] else "–ù–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–π"
                is_suspend = PM_data["–°—Ç–∞—Ç—É—Å"] == "–ó–∞–º–æ—Ä–æ–∂–µ–Ω"
                process_id = PM_data["PID"]

                if current_tab == "–í—Å–µ –ü—Ä–æ—Ü–µ—Å—Å—ã":
                    menu.add_command(label=f"–£–±–∏—Ç—å –ü—Ä–æ—Ü–µ—Å—Å ({critical_state})",
                                     command=lambda: action_process(gui_elements, "kill", process_id))
                    if is_suspend:
                        menu.add_command(label="–†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å",
                                         command=lambda: action_process(gui_elements, "resume", process_id))
                    else:
                        menu.add_command(label="–ó–∞–º–æ—Ä–æ–∑–∏—Ç—å",
                                         command=lambda: action_process(gui_elements, "suspend", process_id))
                    if get_process_critical_status(process_id, run_in_recovery):
                        menu.add_command(label=f"–°–Ω—è—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å",
                                         command=lambda: action_process(gui_elements, "edit_critical_to_false", process_id))
                    if not get_process_critical_status(process_id, run_in_recovery):
                        menu.add_command(label=f"–°–¥–µ–ª–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–º",
                                         command=lambda: action_process(gui_elements, "edit_critical_to_true", process_id))
                    menu.add_separator()
                    menu.add_command(label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å", command=lambda: copy_to_clipboard(manager, process_path))
                    menu.add_command(label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞", command=lambda: copy_to_clipboard(manager, process_name))
                elif current_tab == "–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ü—Ä–æ—Ü–µ—Å—Å—ã" or "–ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ—Ü–µ—Å—Å—ã":
                    menu.add_command(label=f"–°–Ω—è—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å",
                                     command=lambda: action_process(gui_elements, "edit_critical_to_false", process_id))
                    menu.add_command(label=f"–£–±–∏—Ç—å –ü—Ä–æ—Ü–µ—Å—Å ({critical_state})",
                                     command=lambda: action_process(gui_elements, "kill", process_id))
                    menu.add_command(label="–†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å",
                                     command=lambda: action_process(gui_elements, "resume", process_id))
                    menu.add_separator()
                    menu.add_command(label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å", command=lambda: copy_to_clipboard(manager, process_path))
                    menu.add_command(label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞", command=lambda: copy_to_clipboard(manager, process_name))
                else:
                    menu.add_command(label=f"–£–±–∏—Ç—å –ü—Ä–æ—Ü–µ—Å—Å ({critical_state})",
                                     command=lambda: action_process(gui_elements, "kill", process_id))
                    if is_suspend:
                        menu.add_command(label="–†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å",
                                         command=lambda: action_process(gui_elements, "resume", process_id))
                    else:
                        menu.add_command(label="–ó–∞–º–æ—Ä–æ–∑–∏—Ç—å",
                                         command=lambda: action_process(gui_elements, "suspend", process_id))
                    if get_process_critical_status(process_id, run_in_recovery):
                        menu.add_command(label=f"–°–Ω—è—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å",
                                         command=lambda: action_process(gui_elements, "edit_critical_to_false", process_id))
                    if not get_process_critical_status(process_id, run_in_recovery):
                        menu.add_command(label=f"–°–¥–µ–ª–∞—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–º",
                                         command=lambda: action_process(gui_elements, "edit_critical_to_true", process_id))
                    menu.add_separator()
                    menu.add_command(label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—É—Ç—å", command=lambda: copy_to_clipboard(manager, process_path))
                    menu.add_command(label="–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞", command=lambda: copy_to_clipboard(manager, process_name))

            try:
                menu.tk_popup(event.x_root, event.y_root)
            finally:
                menu.grab_release()



        #–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ü–ö–ú
        def handle_right_click(event, gui_elements):
            #–ü–æ–ª—É—á–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—ã–ª —Å–¥–µ–ª–∞–Ω –∫–ª–∏–∫
            item_id = gui_elements["tree"].identify_row(event.y)
            gui_elements["tree"].selection_set(item_id) #–í—ã–¥–µ–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç
            if item_id:
                process_id = int(item_id)
                #–ù–∞—Ö–æ–¥–∏–º –∏—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ PID
                PM_data = next((data for data in gui_elements["treeview_data"] if data.get("PID") == process_id), None)
            else:
                #–ï—Å–ª–∏ –∫–ª–∏–∫ –±—ã–ª –Ω–µ –Ω–∞ —ç–ª–µ–º–µ–Ω—Ç–µ
                PM_data = None

            show_context_menu(event, gui_elements, PM_data, item_id)



        #–ö–æ–ø–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞
        def copy_to_clipboard(manager, text):
            manager.clipboard_clear()
            manager.clipboard_append(text)



        #–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∞–≤–∏—à
        def handle_key_action(event, gui_elements):
            tree = gui_elements["tree"]

            #–ü–æ–ª—É—á–∞–µ–º PID –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
            selected_items = tree.selection()
            if not selected_items:
                return #–ù–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ

            #–¢–∞–∫ –∫–∞–∫ selectmode="browse", –º—ã –æ–∂–∏–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —ç–ª–µ–º–µ–Ω—Ç
            selected_item_id = selected_items[0]
            try:
                process_id = int(selected_item_id)
            except ValueError:
                return #ID –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º (PID)

            action = None
            key = event.keysym

            if key in ["Delete", "Delete_Last"]: #–ö–ª–∞–≤–∏—à–∞ Delete (–£–¥–∞–ª–∏—Ç—å)
                action = "kill"
            elif key == "s": #–ö–ª–∞–≤–∏—à–∞ S (–ó–∞–º–æ—Ä–æ–∑–∏—Ç—å)
                action = "suspend"
            elif key == "u": #–ö–ª–∞–≤–∏—à–∞ U (–†–∞–∑–º–æ—Ä–æ–∑–∏—Ç—å)
                action = "resume"
            elif key == "c": #–ö–ª–∞–≤–∏—à–∞ C (–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å)
                #–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏ –Ω—É–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                is_critical = get_process_critical_status(process_id)
                action = "edit_critical_to_false" if is_critical else "edit_critical_to_true"

            if action:
                #–í—ã–ø–æ–ª–Ω—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
                action_process(gui_elements, action, process_id)



        PM = tk.Tk()
        GUI_ELEMENTS["manager"] = PM
        PM.title(random_string())
        PM.geometry("800x450")

        #–ú–µ–Ω—é
        menubar = tk.Menu(PM)
        #–°–æ–∑–¥–∞–µ–º –≤—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é "–î–µ–π—Å—Ç–≤–∏—è"
        actions_menu = tk.Menu(menubar, tearoff=0)
        actions_menu.add_command(label="–ü–æ–∏—Å–∫", accelerator="Ctrl+F", command=lambda: open_search_dialog(GUI_ELEMENTS))
        actions_menu.add_command(label="–ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ–∏—Å–∫", accelerator="Esc", command=lambda: stop_search(GUI_ELEMENTS))
        menubar.add_cascade(label="–î–µ–π—Å—Ç–≤–∏—è", menu=actions_menu)

        #–ü—É–Ω–∫—Ç "–û –ü—Ä–æ–≥—Ä–∞–º–º–µ"
        menubar.add_command(label="–û –ø—Ä–æ–≥—Ä–∞–º–º–µ", command=about_PM)
        PM.config(menu=menubar)

        #–î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∏–≤—è–∑–∫—É –∫–ª–∞–≤–∏—à Ctrl+F, Esc, Delete, S, U, C
        #–ü–æ–∏—Å–∫
        PM.bind_all("<Control-f>", lambda e: open_search_dialog(GUI_ELEMENTS))
        PM.bind_all("<Control-F>", lambda e: open_search_dialog(GUI_ELEMENTS))

        #–ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ–∏—Å–∫
        PM.bind_all("<Escape>", lambda e: stop_search(GUI_ELEMENTS))

        #–ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏ –¥–µ–π—Å—Ç–≤–∏–π
        PM.bind_all("<Delete>", lambda e: handle_key_action(e, GUI_ELEMENTS))
        PM.bind_all("<s>", lambda e: handle_key_action(e, GUI_ELEMENTS))
        PM.bind_all("<S>", lambda e: handle_key_action(e, GUI_ELEMENTS))
        PM.bind_all("<u>", lambda e: handle_key_action(e, GUI_ELEMENTS))
        PM.bind_all("<U>", lambda e: handle_key_action(e, GUI_ELEMENTS))
        PM.bind_all("<c>", lambda e: handle_key_action(e, GUI_ELEMENTS))
        PM.bind_all("<C>", lambda e: handle_key_action(e, GUI_ELEMENTS))

        #–ü–∞–Ω–µ–ª—å –≤–∫–ª–∞–¥–æ–∫
        GUI_ELEMENTS["notebook"] = ttk.Notebook(PM)
        GUI_ELEMENTS["notebook"].pack(pady=10, padx=10, fill="both", expand=True)
        GUI_ELEMENTS["notebook"].bind("<<NotebookTabChanged>>",
                                      lambda e: on_tab_change(e, GUI_ELEMENTS))

        #–°–æ–∑–¥–∞—ë–º –≤–∫–ª–∞–¥–∫–∏
        tab_names = ["–í—Å–µ –ü—Ä–æ—Ü–µ—Å—Å—ã", "–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ü—Ä–æ—Ü–µ—Å—Å—ã", "–ó–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–µ –ü—Ä–æ—Ü–µ—Å—Å—ã"]
        for tab_name in tab_names:
            frame = ttk.Frame(GUI_ELEMENTS["notebook"], padding="5 5 5 5")
            GUI_ELEMENTS["notebook"].add(frame, text=tab_name)
            GUI_ELEMENTS["tabs"][tab_name] = frame

        #–°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –¢–∞–±–ª–∏—Ü—ã –∏ –°–∫—Ä–æ–ª–ª–±–∞—Ä–∞
        initial_frame = GUI_ELEMENTS["tabs"]["–í—Å–µ –ü—Ä–æ—Ü–µ—Å—Å—ã"]
        GUI_ELEMENTS["tree"] = ttk.Treeview(initial_frame, selectmode="browse")
        GUI_ELEMENTS["vsb"] = ttk.Scrollbar(initial_frame, orient="vertical", command=GUI_ELEMENTS["tree"].yview)
        GUI_ELEMENTS["tree"].configure(yscrollcommand=GUI_ELEMENTS["vsb"].set)
        GUI_ELEMENTS["tree"].pack(side="left", fill="both", expand=True)
        GUI_ELEMENTS["vsb"].pack(side="right", fill="y")

        #–ü—Ä–∏–≤—è–∑–∫–∞ –ü–ö–ú
        GUI_ELEMENTS["tree"].bind("<Button-3>", lambda e: handle_right_click(e, GUI_ELEMENTS))

        #–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–≤–æ–π –≤–∫–ª–∞–¥–∫–∏
        update_list()

        PM.mainloop()
    except Exception as e:
        logger.critical(f"–í –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–µ ProcessManager –ø—Ä–æ–∏–∑–æ—à–ª–∞ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞!\n{e}")
